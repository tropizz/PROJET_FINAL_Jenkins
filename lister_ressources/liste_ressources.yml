  - name: List instances
    amazon.aws.ec2_instance_info:
      filters:
        instance-state-name: running
    register: instances

  - name: List security groups
    amazon.aws.ec2_group_info:
      filters:
        "group-name": "*"
    register: security_groups

  - name: List S3 buckets
    amazon.aws.s3_bucket_info:
    register: s3_buckets

  - name: Print results
    debug:
      var: instances.instances | json_query('[].{InstanceId: InstanceId, Name: Tags[?Key==`Name`].Value|[0]}')

  - name: Print results
    debug:
      var: security_groups.security_groups | json_query('[].{GroupId: GroupId, Name: GroupName}')

  - name: Print results
    debug:
      var: s3_buckets.buckets | json_query('[].{Name: Name}')
